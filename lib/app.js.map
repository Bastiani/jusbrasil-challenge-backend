{"version":3,"sources":["../src/app.js"],"names":["loaders","app","Koa","router","Router","graphqlSettingsPerReq","req","dataloaders","user","header","authorization","graphiql","process","env","NODE_ENV","schema","pretty","context","extensions","document","variables","operationName","result","console","log","formatError","error","message","locations","stack","graphqlServer","use","all","endpoint","routes","allowedMethods"],"mappings":";;;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AAEA;;;;AACA;;IAAYA,O;;AACZ;;;;;;AAXA;AAaA,MAAMC,MAAM,IAAIC,aAAJ,EAAZ;AACA,MAAMC,SAAS,IAAIC,mBAAJ,EAAf;;AAEA,MAAMC,wBAAwB,MAAMC,GAAN,IAAa;AACzC,QAAMC,cAAc,MAAM,4BAAeP,OAAf,CAA1B;AACA,QAAM,EAAEQ,IAAF,KAAW,MAAM,qBAAQD,WAAR,EAAqBD,IAAIG,MAAJ,CAAWC,aAAhC,CAAvB;;AAEA,SAAO;AACLC,cAAUC,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAD9B;AAELC,4BAFK;AAGLC,YAAQ,IAHH;AAILC,aAAS;AACPT,UADO;AAEPF,SAFO;AAGPC;AAHO,KAJJ;AASLW,gBAAY,CAAC,EAAEC,QAAF,EAAYC,SAAZ,EAAuBC,aAAvB,EAAsCC,MAAtC,EAAD,KAAoD;AAC9DC,cAAQC,GAAR,CAAY,qBAAML,QAAN,CAAZ;AACAI,cAAQC,GAAR,CAAYJ,SAAZ;AACAG,cAAQC,GAAR,CAAYH,aAAZ,EAA2BC,MAA3B;AACD,KAbI;AAcLG,iBAAaC,SAAS;AACpBH,cAAQC,GAAR,CAAYE,MAAMC,OAAlB;AACAJ,cAAQC,GAAR,CAAYE,MAAME,SAAlB;AACAL,cAAQC,GAAR,CAAYE,MAAMG,KAAlB;;AAEA,aAAO;AACLF,iBAASD,MAAMC,OADV;AAELC,mBAAWF,MAAME,SAFZ;AAGLC,eAAOH,MAAMG;AAHR,OAAP;AAKD;AAxBI,GAAP;AA0BD,CA9BD;;AAgCA,MAAMC,gBAAgB,0BAAQ,0BAAYzB,qBAAZ,CAAR,CAAtB;;AAEAJ,IAAI8B,GAAJ,CAAQ,wBAAR;;AAEA5B,OAAO6B,GAAP,CAAW,UAAX,EAAuBF,aAAvB;AACA3B,OAAO6B,GAAP,CACE,aADF,EAEE,gDAAc;AACZC,YAAU;AADE,CAAd,CAFF;;AAOAhC,IAAI8B,GAAJ,CAAQ5B,OAAO+B,MAAP,EAAR,EAAyBH,GAAzB,CAA6B5B,OAAOgC,cAAP,EAA7B;;kBAEelC,G","file":"app.js","sourcesContent":["// @flow\n/* eslint-disable no-console */\nimport Koa from 'koa';\nimport Router from 'koa-router';\nimport graphqlHttp from 'koa-graphql';\nimport cors from 'koa-cors';\nimport convert from 'koa-convert';\nimport { print } from 'graphql/language';\nimport { koaPlayground } from 'graphql-playground-middleware';\n\nimport schema from './schema';\nimport * as loaders from './graphql/loader';\nimport { getUser, getDataloaders } from './helper';\n\nconst app = new Koa();\nconst router = new Router();\n\nconst graphqlSettingsPerReq = async req => {\n  const dataloaders = await getDataloaders(loaders);\n  const { user } = await getUser(dataloaders, req.header.authorization);\n\n  return {\n    graphiql: process.env.NODE_ENV !== 'production',\n    schema,\n    pretty: true,\n    context: {\n      user,\n      req,\n      dataloaders,\n    },\n    extensions: ({ document, variables, operationName, result }) => {\n      console.log(print(document));\n      console.log(variables);\n      console.log(operationName, result);\n    },\n    formatError: error => {\n      console.log(error.message);\n      console.log(error.locations);\n      console.log(error.stack);\n\n      return {\n        message: error.message,\n        locations: error.locations,\n        stack: error.stack,\n      };\n    },\n  };\n};\n\nconst graphqlServer = convert(graphqlHttp(graphqlSettingsPerReq));\n\napp.use(cors());\n\nrouter.all('/graphql', graphqlServer);\nrouter.all(\n  '/playground',\n  koaPlayground({\n    endpoint: '/graphql',\n  }),\n);\n\napp.use(router.routes()).use(router.allowedMethods());\n\nexport default app;\n"]}