{"version":3,"sources":["../src/index.js"],"names":["info","console","log","host","port","name","error","process","exit","server","app","callback","listen","graphqlPort","SubscriptionServer","create","onConnect","connectionParams","onDisconnect","execute","subscribe","schema","path"],"mappings":";;AAEA;;AAEA;;AACA;;AAEA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA,CAAC,YAAY;AACX,MAAI;AACF,UAAMA,OAAO,MAAM,yBAAnB;AACAC,YAAQC,GAAR,CAAa,gBAAeF,KAAKG,IAAK,IAAGH,KAAKI,IAAK,IAAGJ,KAAKK,IAAK,EAAhE;AACD,GAHD,CAGE,OAAOC,KAAP,EAAc;AACdL,YAAQK,KAAR,CAAc,+BAAd;AACAC,YAAQC,IAAR,CAAa,CAAb;AACD;;AAED,QAAMC,SAAS,wBAAaC,cAAIC,QAAJ,EAAb,CAAf;;AAEA,QAAMD,cAAIE,MAAJ,CAAWC,mBAAX,EAAwB,MAAM;AAClCC,iDAAmBC,MAAnB,CACE;AACEC,iBAAWC,oBAAoBhB,QAAQC,GAAR,CAAY,gCAAZ,EAA8Ce,gBAA9C,CADjC;AAEEC,oBAAc,MAAMjB,QAAQC,GAAR,CAAY,mCAAZ,CAFtB;AAGEiB,+BAHF;AAIEC,mCAJF;AAKEC;AALF,KADF,EAQE;AACEZ,YADF;AAEEa,YAAM;AAFR,KARF;AAaD,GAdK,CAAN;AAeArB,UAAQC,GAAR,CAAa,0BAAyBW,mBAAY,EAAlD;AACD,CA3BD;AAXA","file":"index.js","sourcesContent":["// @flow\n/* eslint-disable no-console */\nimport { createServer } from 'http';\n\nimport { SubscriptionServer } from 'subscriptions-transport-ws';\nimport { execute, subscribe } from 'graphql';\n\nimport app from './app';\nimport connectToDatabase from './database';\nimport { graphqlPort } from './config';\nimport schema from './schema';\n\n(async () => {\n  try {\n    const info = await connectToDatabase();\n    console.log(`Connected to ${info.host}:${info.port}/${info.name}`);\n  } catch (error) {\n    console.error('Unable to connect to database');\n    process.exit(1);\n  }\n\n  const server = createServer(app.callback());\n\n  await app.listen(graphqlPort, () => {\n    SubscriptionServer.create(\n      {\n        onConnect: connectionParams => console.log('client subscription connected!', connectionParams),\n        onDisconnect: () => console.log('client subscription disconnected!'),\n        execute,\n        subscribe,\n        schema,\n      },\n      {\n        server,\n        path: '/subscriptions',\n      },\n    );\n  });\n  console.log(`Server started on port ${graphqlPort}`);\n})();\n"]}